<!-- This is a static file -->
<!-- served from your routes in server.js -->

<!-- You might want to try something fancier: -->
<!-- html/nunjucks docs: https://mozilla.github.io/nunjucks/ -->
<!-- pug: https://pugjs.org/ -->
<!-- haml: http://haml.info/ -->
<!-- hbs(handlebars): http://handlebarsjs.com/ -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <title>MapTransfer</title>
    <meta name="description" content="A cool thing made with Glitch">
    <link id="favicon" rel="icon" href="https://glitch.com/edit/favicon-app.ico" type="image/x-icon">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>
     <!-- Make sure you put this AFTER Leaflet's CSS -->
     <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
    <!-- import the webpage's stylesheet -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol@0.62.0/dist/L.Control.Locate.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol@0.62.0/src/L.Control.Locate.min.js" charset="utf-8"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

    <link rel="stylesheet" href="/style.css">
  </head>
  
  <body>
  
    <main>
      <aside>
        <form action="https://purple-thunder.glitch.me/create" method="POST" enctype="multipart/form-data">
          <h3>
            Select the files you want to send
          </h3>
          <input type="file" id="files" name="file">
          <hr>

          <div class="range">
            <h3>
              Click on the map 
            </h3>
            <p>
              and tweak the size of the area your download will be available.
            </p>
            <input type="range" id="rangeInput" class="input" min="1" max="10" steps="10" value="3">
            <p class="output">Download range: <span id="rangeOutput"></span></p>
          </div>          
          <hr>
          <input type="hidden" id="latitude" name="latitude">
          <input type="hidden" id="longitude" name="longitude">
          <input type="submit" value="Start upload">
        </form>

      </aside>

      <div id="mapid"></div>
    </main>
    
<!--     <script src="/client.jss"></script> -->
    
    <script type="text/javascript">
      var mymap = L.map('mapid').setView([52.3754419819, 4.930586814], 13);

      L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
        maxZoom: 18,
        id: 'mapbox.streets',
        accessToken: 'pk.eyJ1IjoidGhvbWFzb2ZmaW5nYSIsImEiOiJjamc3cTlyczgwdWs0MndrbDhmeWdrd3RkIn0.44lDtgLNa9soBfbU67ASpQ'
      }).addTo(mymap);


      mymap.addControl(
        L.control.locate({
         locateOptions: {
           maxZoom: 14,
           drawCircle: false
          }
        }
        )
      );

      L.Control.geocoder().addTo(mymap);

      const values = [50, 100, 500, 1000, 5000, 20000, 50000, 100000, 250000, 500000]; // Our list of selectable values
      const latitudeInput = document.getElementById("latitude"),
        longitudeInput = document.getElementById("longitude"),
        input = document.getElementById("rangeInput"),
        output = document.getElementById("rangeOutput");

      let radius = 50; // sets default radius

      let selectedLocation = null;

      input.oninput = function() {
        radius = values[this.value - 1];
        output.innerHTML = formatter(values[this.value - 1]);
        if(circle){
          circle.setRadius(radius);
        }
      };

      input.oninput();

      function formatter(num) {
        return num > 999 ? (num / 1000).toFixed(0) + " km" : num + " m";
      } // formats the distance nicely

      var marker = L.marker(),
        circle = new L.circle();

      function onMapClick(e) {
        latitudeInput.value = e.latlng.lat;
        longitudeInput.value = e.latlng.lng;
        console.log(latitudeInput);
        console.log(longitudeInput);

        marker
          .setLatLng(e.latlng)
          .addTo(mymap);
        circle
          .setLatLng(e.latlng)
          .setRadius(radius)
          .addTo(mymap);
      }

      mymap.on('click', onMapClick);
    </script>    

  </body>
</html>





